---

title: Liquidation Alert System
sidebar_position: 1
-------------------

# Liquidation Alert System

Monitoring user positions for liquidation risk is a critical use case for any DeFi application.
The **Kixago API** provides a normalized `health_factor` that simplifies this process across all supported protocols and chains.

This guide demonstrates how to poll the API and trigger an alert when a user's position drops below a predetermined risk threshold.

---

## ⚙️ Logic Overview

1. **Define Threshold:**
   Set a warning level (e.g., `1.5`) below the actual liquidation threshold (`1.0`).

2. **Fetch Positions:**
   Call the `/lending/positions` endpoint for the user's address.

3. **Filter Risk:**
   Iterate through the returned positions and identify any where the `health_factor` is below the warning threshold.

4. **Trigger Alert:**
   If at-risk positions are found, trigger your preferred notification system (e.g., email, SMS, or Discord webhook).

---

## 💻 JavaScript / Node.js Example

This asynchronous function runs the check and uses a placeholder `sendAlert` function for notifications.

### Prerequisites

You will need a helper function to fetch data from the Kixago API.

```js
// Helper function to fetch data securely using your Kixago API key.
const fetchKixagoPositions = async (userAddress) => {
  const KIXAGO_KEY = process.env.KIXAGO_API_KEY; // Ensure this is set securely
  
  if (!KIXAGO_KEY) {
    throw new Error("KIXAGO_API_KEY environment variable not set.");
  }

  const apiUrl = `https://api.kixago.com/api/v1/lending/positions?address=${userAddress}`;

  const response = await fetch(apiUrl, {
    method: 'GET',
    headers: {
      Authorization: `Bearer ${KIXAGO_KEY}`,
      'Content-Type': 'application/json',
    },
  });
  
  if (!response.ok) {
    throw new Error(`Kixago API call failed with status: ${response.status}`);
  }

  const { data } = await response.json();
  return data;
};
```

---

### Example Notification Function

```js
// Placeholder function for sending real-world notifications.
const sendAlert = async (alertDetails) => {
  console.log(`[ALERT TRIGGERED] ${alertDetails.message}`);
  
  alertDetails.positions.forEach(p => {
    console.log(`- Protocol: ${p.protocol} on ${p.chain}`);
    console.log(`  Current Health Factor: ${p.health_factor}`);
    console.log(`  Liquidation Threshold: ${p.ltv_liquidation_threshold}`);
  });
};
```

---

## 🚨 Alert Logic

```js
// The primary function to check for liquidation risk
const checkLiquidationRisk = async (address) => {
  try {
    const { positions } = await fetchKixagoPositions(address);
    
    const WARNING_THRESHOLD = 1.5; // 1.0 is liquidation, 1.5 is a standard buffer
    
    const atRisk = positions.filter(
      p => p.health_factor < WARNING_THRESHOLD
    );
    
    if (atRisk.length > 0) {
      await sendAlert({
        message: `WARNING: ${address} has ${atRisk.length} positions at risk!`,
        positions: atRisk
      });
    } else {
      console.log(`User ${address} is safe. Health factors are all above ${WARNING_THRESHOLD}.`);
    }
  } catch (error) {
    console.error(`Error checking liquidation risk for ${address}:`, error.message);
  }
};

// Example Usage
const userAddressToMonitor = "0xYourUserAddressHere";

console.log(`Starting risk monitor for ${userAddressToMonitor}.`);

// Run immediately
checkLiquidationRisk(userAddressToMonitor); 

// Poll every 5 minutes
setInterval(() => checkLiquidationRisk(userAddressToMonitor), 5 * 60 * 1000);
```

---

## 💡 Production Tips

### Rate Limits

Respect Kixago's rate limits (100–1000 requests/minute planned).
If monitoring many addresses, stagger requests or use caching.

### Webhooks (Future)

Polling is inefficient.
For high-volume setups, integrate Kixago’s planned **webhook feature** for real-time push-based updates.

### Decimals

Kixago normalizes all token amounts and USD values — no need to manually handle token decimals (e.g., 18 for ETH, 6 for USDC).

---

✅ **You now have a working liquidation alert system using the Kixago API!**
